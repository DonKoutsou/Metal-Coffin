[gd_scene format=3 uid="uid://cyujmksfffet"]

[ext_resource type="Script" uid="uid://uwyb0fvd6pvg" path="res://Scripts/map.gd" id="1_vpest"]
[ext_resource type="PackedScene" uid="uid://dgf0r7r507qef" path="res://Scenes/Towns/Town.tscn" id="7_0ker0"]
[ext_resource type="PackedScene" uid="uid://dp3qdp4mcnmly" path="res://Scenes/tutorial_trigger.tscn" id="9_6an1p"]
[ext_resource type="World3D" uid="uid://bt2lx0rufeimw" path="res://WorldEnv.tres" id="10_28wu2"]
[ext_resource type="PackedScene" uid="uid://kwr75a1p3qrm" path="res://Scenes/Enemies/HostileShip.tscn" id="11_323je"]
[ext_resource type="Script" uid="uid://cu4b2l2v0wida" path="res://Scripts/ship_camera.gd" id="11_a2ujk"]
[ext_resource type="Script" uid="uid://bdn5v3wan8hys" path="res://Scenes/WeatherMan/weather_manager.gd" id="12_1lxys"]
[ext_resource type="Resource" uid="uid://c1buiwym6qkh8" path="res://Resources/Merch/1.EnemySpawnDecider.tres" id="12_m1k6s"]
[ext_resource type="Texture2D" uid="uid://0o8p7b3b8vyl" path="res://Assets/Sand/Ground055S_1K-PNG_NormalGL.png" id="14_a2ujk"]
[ext_resource type="Texture2D" uid="uid://bd38upwrq6cdy" path="res://Assets/Sand/Rock062_1K-PNG_NormalGL.png" id="15_x3wib"]
[ext_resource type="Texture2D" uid="uid://oviytxhbkdkv" path="res://Assets/Sand/Rock062_1K-PNG_Color.png" id="16_28wu2"]
[ext_resource type="PackedScene" uid="uid://cja47tyjnyae" path="res://Scenes/MapMarkers/map_line_drawer.tscn" id="16_sp82o"]
[ext_resource type="PackedScene" uid="uid://dhr5epkvjl588" path="res://Scenes/MapShips/player_ship.tscn" id="17_21a23"]
[ext_resource type="Texture2D" uid="uid://dwkm7bjn0sv1p" path="res://Assets/Sand/Ground033_1K-PNG_Color.png" id="17_445lv"]
[ext_resource type="Material" uid="uid://jnxte4c68wyq" path="res://Shaders/Clouds/CloudMap.tres" id="18_a2ujk"]
[ext_resource type="Shader" uid="uid://c04tnhxowl25v" path="res://Shaders/ground.gdshader" id="18_x3wib"]
[ext_resource type="PackedScene" uid="uid://boe0re3ai5qdj" path="res://dark_blue_background.tscn" id="19_28wu2"]
[ext_resource type="Script" uid="uid://c1kbreeob7tf2" path="res://Scripts/UI/map_pointer_manager.gd" id="19_ccpfd"]
[ext_resource type="AudioStream" uid="uid://bq5ennd48voeu" path="res://Assets/Sounds/MetalClick.mp3" id="19_x3wib"]
[ext_resource type="PackedScene" uid="uid://c3l8v8l2e2pkt" path="res://Scenes/MapMarkers/ShipMarker.tscn" id="20_anlpp"]
[ext_resource type="PackedScene" uid="uid://bgsgcnyyv1gxm" path="res://Scenes/Map/MapSpotMarker.tscn" id="21_oyi6l"]
[ext_resource type="Script" uid="uid://c2ufjbkhk6v0q" path="res://Scripts/UI/CircleDrawer.gd" id="22_fa7wu"]
[ext_resource type="Resource" uid="uid://056ui1umqqh0" path="res://Resources/EventHandlers/ShipControllerEventHandler.tres" id="22_n73so"]
[ext_resource type="PackedScene" uid="uid://buj48d65j7y07" path="res://Scenes/InScreenUI/in_screen_ui.tscn" id="23_53oad"]
[ext_resource type="PackedScene" uid="uid://biel8sjt8vy5t" path="res://Scenes/ScreenUI/screen_ui.tscn" id="24_e5um8"]
[ext_resource type="Resource" uid="uid://dblsu2gs81rs6" path="res://Resources/EventHandlers/UIEventH.tres" id="25_8mjbw"]
[ext_resource type="Script" uid="uid://uwtcmr8brr2" path="res://Scripts/UI/RegionLineDrawer.gd" id="27_445lv"]
[ext_resource type="Texture2D" uid="uid://bpghre0s4hi8" path="res://Scenes/WeatherMan/weathernoise.tres" id="30_xwtib"]
[ext_resource type="FastNoiseLite" uid="uid://rctm40njxk5b" path="res://Scenes/WeatherMan/testnoise.tres" id="31_xwtib"]

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_kgrij"]
light_mode = 1

[sub_resource type="Gradient" id="Gradient_eb1s8"]
offsets = PackedFloat32Array(0.52029, 0.550725)

[sub_resource type="FastNoiseLite" id="FastNoiseLite_eb1s8"]
noise_type = 3
frequency = 0.0035
cellular_distance_function = 2
cellular_return_type = 2

[sub_resource type="NoiseTexture2D" id="NoiseTexture2D_445lv"]
width = 1024
height = 1024
noise = SubResource("FastNoiseLite_eb1s8")
color_ramp = SubResource("Gradient_eb1s8")
seamless = true
seamless_blend_skirt = 1.0

[sub_resource type="ShaderMaterial" id="ShaderMaterial_28wu2"]
shader = ExtResource("18_x3wib")
shader_parameter/GroundTexture = ExtResource("16_28wu2")
shader_parameter/GroundTexture2 = ExtResource("17_445lv")
shader_parameter/NoiseTexture = SubResource("NoiseTexture2D_445lv")
shader_parameter/GroundNormalTexture = ExtResource("15_x3wib")
shader_parameter/GroundNormal2Texture = ExtResource("14_a2ujk")
shader_parameter/NormalD = 1.0
shader_parameter/Light = 1.0
shader_parameter/offset = Vector2(0, 0)
shader_parameter/Scale1 = Vector2(40, 40)
shader_parameter/Scale2 = Vector2(40, 40)

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_28wu2"]
light_mode = 1

[sub_resource type="CanvasItemMaterial" id="CanvasItemMaterial_w8yg2"]
light_mode = 1

[node name="Map" type="CanvasLayer" unique_id=584405440 node_paths=PackedStringArray("_InScreenUI", "_ScreenUI", "_Camera", "MapLines", "MapSpots", "Region", "Road", "MapLine")]
layer = 0
follow_viewport_enabled = true
script = ExtResource("1_vpest")
_InScreenUI = NodePath("SubViewportContainer/ViewPort/InScreenUI")
_ScreenUI = NodePath("ScreenUI")
_Camera = NodePath("SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/ShipCamera")
MapLines = NodePath("SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager/MapLines")
MapSpots = NodePath("SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapSpots")
Region = NodePath("SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager/RegionMapDrawer")
Road = NodePath("SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/RoadLineDrawer")
MapLine = NodePath("SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager/MapLineDrawer")
TownSpotScene = ExtResource("7_0ker0")
EnemyScene = ExtResource("11_323je")
TutorialTrigger = ExtResource("9_6an1p")
VillageType = "uid://df37gonu46vbl"
CityType = "uid://du24ilvkea51x"
CapitalType = "uid://dyvpncg7tolc7"
FinalCityType = "uid://1vptbvrlos7"
EnemyShipNameList = "uid://cqn4njtiebgrb"
MapSize = 100
MinDistance = 1500.0
SpawningBounds = Vector2(8000, 250000)
EnSpawner = ExtResource("12_m1k6s")
ControllerEvH = ExtResource("22_n73so")

[node name="SubViewportContainer" type="SubViewportContainer" parent="." unique_id=1709335464]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 342.0
offset_top = 62.0
offset_right = -343.0
offset_bottom = -63.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 3
size_flags_vertical = 3
stretch = true

[node name="ViewPort" type="SubViewport" parent="SubViewportContainer" unique_id=580875506]
process_mode = 1
disable_3d = true
own_world_3d = true
world_3d = ExtResource("10_28wu2")
handle_input_locally = false
audio_listener_enable_2d = true
positional_shadow_atlas_size = 512
size = Vector2i(595, 595)
render_target_update_mode = 4

[node name="SubViewportContainer" type="SubViewportContainer" parent="SubViewportContainer/ViewPort" unique_id=177781806]
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
stretch = true

[node name="SubViewport" type="SubViewport" parent="SubViewportContainer/ViewPort/SubViewportContainer" unique_id=1417639039]
disable_3d = true
own_world_3d = true
handle_input_locally = false
canvas_item_default_texture_filter = 0
audio_listener_enable_2d = true
positional_shadow_atlas_size = 0
positional_shadow_atlas_16_bits = false
size = Vector2i(595, 595)
render_target_update_mode = 4

[node name="Darkness" type="CanvasModulate" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=2089661940]
color = Color(0, 0, 0, 1)

[node name="RoadLineDrawer" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=232394766 instance=ExtResource("16_sp82o")]
z_index = -1
RoadLines = true

[node name="MapSpots" type="Node2D" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=1291599953]

[node name="WeatherManager" type="TextureRect" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=932244054]
visible = false
modulate = Color(0.82, 0.82, 0.82, 1)
z_index = 1
texture_filter = 3
material = SubResource("CanvasItemMaterial_kgrij")
custom_minimum_size = Vector2(41.6, 40.6)
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
texture = ExtResource("30_xwtib")
stretch_mode = 5
script = ExtResource("12_1lxys")
N = ExtResource("31_xwtib")
EventHandler = ExtResource("25_8mjbw")

[node name="ShipCamera" type="Camera2D" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=2053726518 node_paths=PackedStringArray("Background", "Grid", "Cloud", "Ground", "WeatherMan", "ClickSound") groups=["Clock"]]
position = Vector2(576, 324)
process_callback = 0
position_smoothing_speed = 20.0
editor_draw_limits = true
script = ExtResource("11_a2ujk")
Background = NodePath("DarkBlueBackground")
Grid = NodePath("Grid")
Cloud = NodePath("Clouds")
Ground = NodePath("Ground")
WeatherMan = NodePath("../WeatherManager")
ClickSound = NodePath("AudioStreamPlayer")
UIEventHandle = ExtResource("25_8mjbw")

[node name="Ground" type="ColorRect" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/ShipCamera" unique_id=2027882013]
z_index = -3
texture_filter = 3
material = SubResource("ShaderMaterial_28wu2")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -766.0
offset_top = -775.0
offset_right = 734.0
offset_bottom = 725.0
grow_horizontal = 2
grow_vertical = 2

[node name="Clouds" type="ColorRect" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/ShipCamera" unique_id=156698642]
material = ExtResource("18_a2ujk")
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = -766.0
offset_top = -775.0
offset_right = 734.0
offset_bottom = 725.0
grow_horizontal = 2
grow_vertical = 2

[node name="DarkBlueBackground" type="ColorRect" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/ShipCamera" unique_id=61913385]
material = SubResource("CanvasItemMaterial_28wu2")
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -15000.0
offset_top = -15000.0
offset_right = 15000.0
offset_bottom = 15000.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 2
color = Color(0.167403, 0.285599, 0.294053, 1)

[node name="Grid" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/ShipCamera" unique_id=372542382 instance=ExtResource("19_28wu2")]
z_index = 1
material = SubResource("CanvasItemMaterial_28wu2")
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
Col = Color(0, 0, 0, 0.2)
EventHandler = ExtResource("25_8mjbw")

[node name="AudioStreamPlayer" type="AudioStreamPlayer" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/ShipCamera" unique_id=492282193]
stream = ExtResource("19_x3wib")
volume_db = -5.0
pitch_scale = 1.7
bus = &"MapSounds"

[node name="PlayerShip" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=1170772852 instance=ExtResource("17_21a23")]
position = Vector2(126.5, 154.5)

[node name="MapPointerManager" type="Node2D" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport" unique_id=67114702 node_paths=PackedStringArray("CircleDr", "MapLonePos")]
z_index = 1025
material = SubResource("CanvasItemMaterial_w8yg2")
script = ExtResource("19_ccpfd")
CircleDr = NodePath("CircleDrawer")
MapLonePos = NodePath("MapLines")
MarkerScene = ExtResource("20_anlpp")
MapSpotMarkerScene = ExtResource("21_oyi6l")
FriendlyColor = Color(0.483, 100, 0.381, 1)
EnemyColor = Color(100, 0.094, 0, 1)
ConvoyColor = Color(100, 0.764, 0.081, 1)
UIEventH = ExtResource("25_8mjbw")
ControllerEventHandler = ExtResource("22_n73so")

[node name="RegionMapDrawer" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager" unique_id=890045518 instance=ExtResource("16_sp82o")]
script = ExtResource("27_445lv")
RegionTrans = 0.2
ResizeLinesWithZoom = true

[node name="MapLines" type="Node2D" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager" unique_id=1517326412]
use_parent_material = true

[node name="MapLineDrawer" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager" unique_id=560404792 instance=ExtResource("16_sp82o")]
modulate = Color(1, 1, 1, 0.2)
ResizeLinesWithZoom = true

[node name="CircleDrawer" type="Node2D" parent="SubViewportContainer/ViewPort/SubViewportContainer/SubViewport/MapPointerManager" unique_id=1002635144 groups=["ZoomAffected"]]
use_parent_material = true
script = ExtResource("22_fa7wu")
ShipControllerEvent = ExtResource("22_n73so")
Col = Color(100, 0.395, 0.144, 1)

[node name="InScreenUI" parent="SubViewportContainer/ViewPort" unique_id=391064499 instance=ExtResource("23_53oad")]
layer = 3

[node name="ScreenUI" parent="." unique_id=1211286395 instance=ExtResource("24_e5um8")]

[connection signal="gui_input" from="SubViewportContainer/ViewPort/SubViewportContainer" to="." method="_MAP_INPUT"]
